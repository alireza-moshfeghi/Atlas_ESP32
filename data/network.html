<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="theme-color" content="#818CF8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atlas Panel</title>
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body class="pt-5">
  <nav class="navbar navbar-expand-sm navbar-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand fs-5 fw-semibold">Atlas Panel</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="status">Status</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="devices">Devices</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="reports">Reports</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="history">History</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="settings">Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="network">Network</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about">About</a>
          </li>
        </ul>
        <div id="btnBox1" class="d-block d-md-none mb-1">
        </div>
      </div>
      <div id="btnBox2" class="d-none d-md-block">
      </div>
    </div>
  </nav>
  <div class="d-flex justify-content-center flex-wrap gap-3 mt-4 mb-3">
    <div class="col-11 col-md-4 item rounded-4">
      <div class="mt-3 mb-3">
        <span class="fs-5 item-subtitle fw-semibold ps-3 ps-md-4">Access Point</span>
      </div>
      <div class="d-flex flex-column justify-content-center align-items-center h-75 w-100">
        <div class="d-flex flex-column w-100 px-4 px-lg-5 py-3">
          <label for="apName" class="mb-2 fw-bold">AP Name:</label>
          <input type="text" id="apName" class="form-control w-100"/>
          <label for="apPass" class="mb-2 mt-2 fw-bold">AP Password:</label>
          <input type="password" id="apPass" class="form-control w-100"/>
          <div class='form-check mt-2 w-100'>
            <input type='checkbox' class='form-check-input' id='showAPPass' onclick='showAPPassword(this)'
              style='border-color: var(--up-color-light);'>
            <label for='showAPPass' class='form-check-label fs-6' style='color: var(--bs-secondary-color);'>Show
              Password</label>
          </div>
        </div>
        <div class="pt-3 mb-4">
          <span class="item-subtitle fs-6 fw-semibold">Access point for device connection</span>
        </div>
      </div>
    </div>
    <div class="col-11 col-md-4 item rounded-4">
      <div class="mt-3 mb-3">
        <span class="fs-5 item-subtitle fw-semibold ps-3 ps-md-4">Wi-Fi Station</span>
      </div>
      <div class="d-flex flex-column justify-content-center align-items-center h-75 w-100">
        <div class="d-flex flex-column w-100 px-4 px-lg-5 py-3">
          <label for="stName" class="mb-2 mt-2 fw-bold">SSID:</label>
          <input type="text" id="stName" class="form-control w-100"/>
          <label for="stPass" class="mb-2 mt-2 fw-bold">Password:</label>
          <input type="password" id="stPass" class="form-control w-100"/>
          <div class='form-check mt-2 w-100'>
            <input type='checkbox' class='form-check-input' id='showSTPass' onclick='showSTPassword(this)'
              style='border-color: var(--up-color-light);'>
            <label for='showSTPass' class='form-check-label fs-6' style='color: var(--bs-secondary-color);'>Show
              Password</label>
          </div>
        </div>
        <div class="pt-3 mb-4">
          <span class="item-subtitle fs-6 fw-semibold">Connects to Wi-Fi for Internet</span>
        </div>
      </div>
    </div>
    <div class="col-11 col-md-4 item rounded-4">
      <div class="mt-3 mb-3">
        <span class="fs-5 item-subtitle fw-semibold ps-3 ps-md-4">Change Username</span>
      </div>
      <div class="d-flex flex-column justify-content-center align-items-center h-75 w-100">
        <div class="d-flex flex-column w-100 px-4 px-lg-5 py-3">
          <label for="oldUsername" class="mb-2 mt-2 fw-bold">Current Username:</label>
          <input type="text" id="oldUsername" class="form-control w-100" readonly />
          <label for="newUsername" class="mb-2 mt-2 fw-bold">New Username:</label>
          <input type="text" id="newUsername" class="form-control w-100" />
        </div>
        <div class="pt-4 pt-md-5 mb-4">
          <span class="item-subtitle fs-6 fw-semibold">Update your account username</span>
        </div>
      </div>
    </div>
    <div class="col-11 col-md-4 item rounded-4">
      <div class="mt-3 mb-3">
        <span class="fs-5 item-subtitle fw-semibold ps-3 ps-md-4">Change Password</span>
      </div>
      <div class="d-flex flex-column justify-content-center align-items-center h-75 w-100">
        <div class="d-flex flex-column w-100 px-4 px-lg-5 py-3">
          <label for="oldPassword" class="mb-2 mt-2 fw-bold">Current Password:</label>
          <input type="password" id="oldPassword" class="form-control w-100" />
          <label for="newPassword" class="mb-2 mt-2 fw-bold">New Password:</label>
          <input type="password" id="newPassword" class="form-control w-100" />
          <div class='form-check mt-2 w-100'>
            <input type='checkbox' class='form-check-input' id='showACPass' onclick='showACPassword(this)'
              style='border-color: var(--up-color-light);'>
            <label for='showACPass' class='form-check-label fs-6' style='color: var(--bs-secondary-color);'>Show
              Password</label>
          </div>
        </div>
        <div class="pt-3 mb-4">
          <span class="item-subtitle fs-6 fw-semibold">Update your account password</span>
        </div>
      </div>
    </div>
    <div class="col-11 col-md-6 col-lg-4 item rounded-4 pb-3">
      <div class="mt-3 mb-3">
        <span class="fs-5 item-subtitle fw-semibold ps-3 ps-md-4">Network Settings</span>
      </div>
      <div class="d-flex flex-column justify-content-start align-items-stretch h-auto w-100">
        <div class="d-flex flex-column w-100 px-4 px-lg-5 py-1">
          <label for="netMode" class="mb-2 fw-bold">Mode:</label>
          <select id="netMode" class="form-select w-100" onchange="modeChange(this)">
            <option value="dhcp" selected>DHCP (Automatic)</option>
            <option value="static">Static (Manual)</option>
          </select>
          <div id="staticFields" class="mt-3 d-none">
            <label for="ipAddress" class="mb-2 fw-bold">IP Address:</label>
            <input type="text" id="ipAddress" class="form-control w-100 mb-3" />
            <label for="subnetMask" class="mb-2 fw-bold">Subnet Mask:</label>
            <input type="text" id="subnetMask" class="form-control w-100 mb-3" />
            <label for="gateway" class="mb-2 fw-bold">Gateway:</label>
            <input type="text" id="gateway" class="form-control w-100 mb-3" />
            <label for="dns" class="mb-2 fw-bold">DNS Server:</label>
            <input type="text" id="dns" class="form-control w-100" />
          </div>
        </div>
        <div class="pt-3 mb-4 text-center">
          <span class="item-subtitle fs-6 fw-semibold">Configure Network Settings</span>
        </div>
      </div>
    </div>

  </div>
  <div class="d-flex flex-column align-items-center pb-3">
    <hr class="col-11 col-md-9">
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-purple" onclick="saveNetwork(this)">Save Changes</button>
      <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#resetModal">Restart Modal</button>
    </div>
  </div>
  <div class="blank position-fixed">
  </div>
  <div class="center position-fixed py-2 px-3 rounded-4 bg-light shadow">
    <div class="d-flex align-items-center gap-2">
      <div class="spinner-border text-purple me-1" role="status" aria-hidden="true"></div>
      <span id="alert" class="fs-5 fw-semibold">Loading...</span>
    </div>
  </div>
  <div class="modal fade" id="alertModal" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" style='background-color: var(--bd-color-light);'>
          <h4 id="modal_title" class="modal-title">Modal Heading</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div id="modal_text" class="modal-body mb-3"></div>
        <div class="modal-footer" style='background-color: var(--bd-color-light);'>
          <button type="button" class="btn btn-purple" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="loginModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" style='background-color: var(--bd-color-light);'>
          <h4 class="modal-title">Sign in</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class='d-flex flex-column align-items-center py-4'>
          <div class="col-10 col-md-9">
            <div class="alert alert-purple mb-3 mt-0 w-100" role="alert" style="line-height: 0.5; display: none;"
              id="alert_text"></div>
            <input type='text' class='form-control fs-6 w-100 mb-1' id='username' name='username'
              style='border-color: var(--up-color-light);' placeholder='Username' />
            <input type='password' class='form-control fs-6 w-100 mt-2' id='password' name='password'
              style='border-color: var(--up-color-light);' placeholder='Password' />
            <div class='form-check mt-2 w-100'>
              <input type='checkbox' class='form-check-input' id='showPass' onclick='showPassword(this)'
                style='border-color: var(--up-color-light);'>
              <label for='showPass' class='form-check-label fs-6' style='color: var(--bs-secondary-color);'>Show
                Password</label>
            </div>
          </div>
        </div>
        <div class="modal-footer" style='background-color: var(--bd-color-light);'>
          <button id="logBtn" type="button" class="btn btn-purple" onclick='loginBtn(this);'>Login</button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="logoutModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" style='background-color: var(--bd-color-light);'>
          <h4 class="modal-title">Logout Confirmation</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body mb-3">Are you sure you want to log out? Any unsaved changes may be lost.</div>
        <div class="modal-footer" style='background-color: var(--bd-color-light);'>
          <button type="button" class="btn btn-purple" onclick='logoutBtn(this);'>Yes</button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">No</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="resetModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" style='background-color: var(--bd-color-light);'>
          <h4 class="modal-title">Restart Module</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body mb-3">Are you sure you want to restart the module? Any unsaved changes may be lost.</div>
        <div class="modal-footer" style='background-color: var(--bd-color-light);'>
          <button type="button" class="btn btn-purple" onclick='resetModule(this);'>Yes</button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">No</button>
        </div>
      </div>
    </div>
  </div>
  <script src="assets/js/jquery-3.7.1.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#loginModal input').keypress(function(e) {
          if (e.which === 13) {
              e.preventDefault();
              loginBtn($("#logBtn"));
          }
      });
    });
    let errorShow = "";
    let ajaxInProgress = false;
    let login = false;
    function map(value, in_min, in_max, out_min, out_max) {
      return (value - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    }
    setTimeout(() => {
      $.ajax({
        url: "/getNetwork",
        type: 'POST',
        dataType: 'json',
        data: {
          'sessionID': localStorage.getItem("sessionID")
        },
        success: function (data) {
          if (data.login) login = true;
          if (!data.login && data.forceLogin) {
            window.location.href = '/login';
          }
          $("#apName").val(data.apName);
          $("#apPass").val(data.apPass);
          $("#stName").val(data.stName);
          $("#stPass").val(data.stPass);
          if (data.dhcpMode)
            $("#netMode").val("dhcp");
          else
            $("#netMode").val("static");
          $("#netMode").trigger("change");
          $("#ipAddress").val(data.ipAddress);
          $("#subnetMask").val(data.subnetMask);
          $("#gateway").val(data.gateway);
          $("#dns").val(data.dns);
          $("#oldUsername").val(data.username);
          setTimeout(() => {
            $(".blank").fadeOut(500);
            $(".center").fadeOut(500);
          }, 750);
          setTimeout(() => {
            if (data.errorTitle != "none" && data.errorText != "none" && data.errorText != errorShow) {
              $("#modal_title").text(data.errorTitle);
              $("#modal_text").text(data.errorText);
              var myModalEl = document.getElementById('alertModal');
              var myModal = new bootstrap.Modal(myModalEl);
              myModal.show();
              errorShow = data.errorText;
            }
          }, 1250)
        }, error: function (xhr, status) {
          if (xhr.status == 0) {
            $("#alert").text("Connecting...")
            $(".blank").fadeIn(500);
            $(".center").fadeIn(500);
          }
        }
      });
    }, 0);
    setInterval(() => {
      if (ajaxInProgress) return;
      ajaxInProgress = true;
      $.ajax({
        url: "/getStatus",
        type: 'POST',
        dataType: 'json',
        data: {
          'sessionID': localStorage.getItem("sessionID")
        },
        success: function (data) {
          ajaxInProgress = false;
          if (data.login && !login)
            location.reload();
          if (data.login) {
            $("#btnBox1").html("<button class='btn btn-purple' data-bs-toggle='modal' data-bs-target='#logoutModal'>Log out</button>");
            $("#btnBox2").html("<button class='btn btn-purple' data-bs-toggle='modal' data-bs-target='#logoutModal'>Log out</button>");
          }
          else {
            $("#btnBox1").html("<button class='btn btn-purple' data-bs-toggle='modal' data-bs-target='#loginModal'>Sign in</button>");
            $("#btnBox2").html("<button class='btn btn-purple' data-bs-toggle='modal' data-bs-target='#loginModal'>Sign in</button>");
          }
          if (!data.login && data.forceLogin) {
            window.location.href = '/login';
          }
          setTimeout(() => {
            $(".blank").fadeOut(500);
            $(".center").fadeOut(500);
          }, 750);
          setTimeout(() => {
            if (data.errorTitle != "none" && data.errorText != "none" && data.errorText != errorShow) {
              $("#modal_title").text(data.errorTitle);
              $("#modal_text").text(data.errorText);
              var myModalEl = document.getElementById('alertModal');
              var myModal = new bootstrap.Modal(myModalEl);
              myModal.show();
              errorShow = data.errorText;
            }
          }, 1250)
        }, error: function (xhr, status) {
          ajaxInProgress = false;
          if (xhr.status == 0) {
            $("#alert").text("Connecting...")
            $(".blank").fadeIn(500);
            $(".center").fadeIn(500);
          }
        }
      });
    }, 1000);
  </script>
  <script src="assets/js/script.js"></script>
</body>

</html>